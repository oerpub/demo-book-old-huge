<!doctype html>
<html>
<head>
<title>Content of EPUB</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style text>
#books {
  float: left;
  border: 1px solid red;
  width: 400px;
}

#navs {
  float: left;
  left: 200px;
  width: 200px;
  border: 1px solid blue;
  display:none;
  visibility: hidden;
}

#content {
  margin-left: 400px;
  border: 1px solid green;
}
</style>
<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="mathjax" src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-MML-AM_HTMLorMML-full"></script>
     <script>

        // get relative path from a filename url
        // e.g. http://whatever.com/here/togo/file.htm
        // returns /here/togo/
        function getDirectory(url)
        {
          var tempurl = document.createElement('a');
          tempurl.href = url;
          var pathArray = tempurl.pathname.split('/');
          var newPathname = "";
          for ( i = 0; i < pathArray.length-1; i++ ) {
            newPathname += pathArray[i];
            newPathname += "/";
          }
          return newPathname;
        }

        $(document).ready(function(){
            // Parse EPUB:
            // Parse container.xml
            $.ajax({
                type: "GET",
                url: "META-INF/container.xml",
                dataType: "xml",
                success: function(xml) {
                    $(xml).find('rootfile').each(function(){
                        var opf = $(this).attr('full-path');

                        // Parse OPFs
                        $.ajax({
                            type: "GET",
                            url: opf,
                            dataType: "xml",
                            success: function(xml) {
                                $(xml).find('item[properties="nav"]').each(function(){
                                    var nav = $(this).attr('href');
                                    nav = getDirectory(opf) + nav;
                                    $.get(nav)
                                       .success(function(data) {
                                            $('<div class="book"></div>')
                                              .attr('directory', getDirectory(nav))
                                              .html(data)
                                              .appendTo('#books');
                                       })
                                });
                            }
                        });
                    });
                }
            });

            // Prevent opening links. 
            $('#books').on('click', 'a', function(e) {
               e.preventDefault();
               // replace wrong relative path with correct one.
               // TODO: better replace every a link on load. Would be less hackish.
               var contenturl = $(this).attr('href');
               contenturl = $(this).parents('div[class="book"]').attr('directory') + contenturl;
               $("#content").load(contenturl, 
                    function (responseText, textStatus, XMLHttpRequest) {
                      if (textStatus == "success") {
                         MathJax.Hub.Queue(["Typeset",MathJax.Hub,'content']);
                      }
                      if (textStatus == "error") {
                           // oh noes!
                      }
                    }
              );
            });
       });
     </script>
</head>
<body>
  <h1>Contents of EPUB</h1>
  <div id="books"></div>
  <div id="navs"></div>
  <div id="content"></div>
</body>
</html>